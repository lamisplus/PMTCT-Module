<?xml version="1.0" encoding="utf-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.5.xsd">

    <property name="autoIncrement" value="true"/>

    <changeSet failOnError="true"  id="20230209-001" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_information" columnName="last_visit_date" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_information
                ADD last_visit_date date
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20230209-002" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_information" columnName="next_appointment_date" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_information
                ADD next_appointment_date date
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20230209-003" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_information" columnName="default_days" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_information
                ADD default_days integer
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20230210-003" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_information" columnName="infant_outcome_at18_months" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_information
                ADD infant_outcome_at18_months character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>


    <changeSet failOnError="true"  id="20230209-004" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="last_visit_date" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD last_visit_date date
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20230209-005" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="next_appointment_date" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD next_appointment_date date
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20230209-006" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="default_days" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD default_days integer
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20230209-007" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="tested_syphilis" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD tested_syphilis character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20230209-008" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="test_result_syphilis" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD test_result_syphilis character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20230209-009" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="treated_syphilis" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD treated_syphilis character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20230209-010" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="referred_syphilis_treatment" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD referred_syphilis_treatment character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20230209-011" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="static_hiv_status" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD  static_hiv_status character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20230209-012" author="drkarim-data-fi">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="source_of_referral" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD source_of_referral character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>
    <changeSet failOnError="true" author="peter-data-fi" id="20230209-013">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="person_uuid" />
            </not>
        </preConditions>
        <sql>

            ALTER TABLE public.pmtct_enrollment
                ADD COLUMN person_uuid character varying COLLATE pg_catalog."default";

            ALTER TABLE pmtct_enrollment
                ADD CONSTRAINT pmtct_enrollment_person_uuid_fk
                    FOREIGN KEY (person_uuid) REFERENCES patient_person (uuid);
        </sql>
    </changeSet>
    <changeSet failOnError="true" author="peter-data-fi" id="20230209-014">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="pmtct_type" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
                ADD COLUMN pmtct_type character varying(255);

        </sql>
    </changeSet>
    <changeSet failOnError="true" author="peter-data-fi" id="20230209-015">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="archived" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
                ADD COLUMN archived bigint;

        </sql>
    </changeSet>

    <changeSet failOnError="true" author="peter-data-fi" id="20230209-016">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="hiv_status" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
                ADD COLUMN hiv_status character varying(255);

        </sql>
    </changeSet>

    <changeSet failOnError="true" author="peter-data-fi" id="20230209-017">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="hospital_number" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
                ADD COLUMN hospital_number character varying(255);

        </sql>
    </changeSet>

    <changeSet failOnError="true" author="peter-data-fi" id="20230209-018">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="lmp" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
                ADD COLUMN lmp date;

        </sql>
    </changeSet>

    <changeSet failOnError="true" author="peter-data-fi" id="20230209-019">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_delivery" columnName="person_uuid" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_delivery
                ADD COLUMN person_uuid character varying COLLATE pg_catalog."default";

            ALTER TABLE pmtct_delivery
                ADD CONSTRAINT pmtct_delivery_person_uuid_fk
                    FOREIGN KEY (person_uuid) REFERENCES patient_person (uuid);
        </sql>
    </changeSet>

    <changeSet failOnError="true" author="peter-data-fi" id="20230209-020">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_information" columnName="mother_person_uuid" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_information
                ADD COLUMN mother_person_uuid character varying COLLATE pg_catalog."default";

            ALTER TABLE pmtct_infant_information
                ADD CONSTRAINT pmtct_infant_information_mother_person_uuid_fk
                    FOREIGN KEY (mother_person_uuid) REFERENCES patient_person (uuid);
        </sql>
    </changeSet>

    <changeSet failOnError="true" author="peter-data-fi" id="20230209-021">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_visit" columnName="mother_person_uuid" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_visit
                ADD COLUMN mother_person_uuid character varying COLLATE pg_catalog."default";

            ALTER TABLE pmtct_infant_information
                ADD CONSTRAINT pmtct_infant_visit_mother_person_uuid_fk
                    FOREIGN KEY (mother_person_uuid) REFERENCES patient_person (uuid);
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20240227-001" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_anc" columnName="anc_setting" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_anc
                ADD anc_setting character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20240227-002" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_information" columnName="body_weight" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_information
                ADD body_weight bigint
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20240227-003" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_delivery" columnName="place_of_delivery" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_delivery
            ADD place_of_delivery character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20240228-101" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="mother_art_initiation_time" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
            ADD mother_art_initiation_time character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20240228-102" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="regimen_type_id" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
            ADD regimen_type_id bigint
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20240228-103" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="regimen_id" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
            ADD regimen_id character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="2024022801-104" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_information" columnName="ctx_status" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_information
            ADD ctx_status character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="2024022802-105" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="hepatitisb" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
            ADD hepatitisb character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="2024022803-106" author="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_enrollment" columnName="urinalysis" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_enrollment
            ADD urinalysis character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="2024031401-100" author="jOSHUA gABRIEL">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_mother_visitation" columnName="date_of_delivery" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_mother_visitation ADD COLUMN date_of_delivery DATE;
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20240522-109" author="sam">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_arv" columnName="timing_of_avr_after_72hours" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_arv ADD COLUMN timing_of_avr_after_72hours character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20240522-108" author="sam">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_arv" columnName="timing_of_avr_within_72hours" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_arv ADD COLUMN timing_of_avr_within_72hours character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>
    <changeSet failOnError="true"  id="20240522-107" author="sam">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="pmtct_infant_pcr" columnName="age_at_test" />
            </not>
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_pcr ADD COLUMN age_at_test character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true"  id="20240522-106" author="sam">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="pmtct_infant_pcr" columnName="age_at_test" />
        </preConditions>
        <sql>
            ALTER TABLE pmtct_infant_pcr ALTER COLUMN age_at_test TYPE character varying(255) COLLATE pg_catalog."default"
        </sql>
    </changeSet>

    <changeSet failOnError="true" author="20240613-003" id="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM pg_attribute
                WHERE attrelid = (SELECT oid FROM pg_class WHERE relname = 'pmtct_anc')
                AND attname = 'previously_known_hiv_status';
            </sqlCheck>
        </preConditions>
        <sql>
            ALTER TABLE IF EXISTS pmtct_anc ADD COLUMN previously_known_hiv_status character varying;
        </sql>
    </changeSet>

    <changeSet failOnError="true" author="20240613-005" id="israel-ace3">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM pg_attribute
                WHERE attrelid = (SELECT oid FROM pg_class WHERE relname = 'pmtct_enrollment')
                AND attname = 'time_of_hiv_diagnosis';
            </sqlCheck>
        </preConditions>
        <sql>
            ALTER TABLE IF EXISTS pmtct_enrollment ADD COLUMN time_of_hiv_diagnosis character varying;
        </sql>
    </changeSet>

    <changeSet failOnError="true" author="ganiyat-247" id="20240623">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">
                SELECT COUNT(*)
                FROM pg_attribute
                WHERE attrelid = (SELECT oid FROM pg_class WHERE relname = 'pmtct_delivery')
                AND attname = 'non_hbv_exposed_infant_given_hb_within_24hrs';
            </sqlCheck>
        </preConditions>
        <sql>
            ALTER TABLE IF EXISTS pmtct_delivery ADD COLUMN non_hbv_exposed_infant_given_hb_within_24hrs character varying;
        </sql>
    </changeSet>

</databaseChangeLog>